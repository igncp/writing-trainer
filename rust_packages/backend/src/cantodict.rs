use regex::Regex;
use reqwest::{Client, Url};
use std::collections::HashMap;

async fn query_cantodict(search_word: &str) -> Result<String, String> {
    let client = Client::new();

    let url =
        Url::parse("http://www.cantonese.sheik.co.uk/scripts/wordsearch.php?level=0").unwrap();

    let encode_word = urlencoding::encode(search_word);
    let body = format!(
        "TEXT={}&SEARCHTYPE=1&radicaldropdown=0&searchsubmit=search",
        encode_word
    );

    let response = client
        .post(url)
        .header("Content-Type", "application/x-www-form-urlencoded")
        .header("User-Agent", "curl/7.68.0")
        .body(body)
        .send()
        .await
        .map_err(|e| e.to_string())?;

    let body = response.text().await.unwrap();
    let word_url = get_word_url(search_word, &body).ok_or("None".to_string())?;

    let response = client
        .get(word_url)
        .header("User-Agent", "curl/7.68.0")
        .send()
        .await
        .map_err(|e| e.to_string())?;

    let body = response.text().await.unwrap();

    get_definitions(&body).ok_or("None".to_string())
}

pub async fn query_cantodict_sentence(search_word: &str) -> HashMap<String, String> {
    let mut result: HashMap<String, String> = HashMap::new();

    let mut previous_word = String::new();
    for character in search_word.chars() {
        let word = character.to_string();
        if !previous_word.is_empty() {
            let combined_word = format!("{}{}", previous_word, word);
            result.insert(combined_word.clone(), "".to_string());
        }
        previous_word = word;
    }

    let futures = result.iter_mut().map(|(word, definition)| async {
        let query_result = query_cantodict(word).await;
        if let Ok(definition_text) = query_result {
            definition.push_str(&definition_text);
        }
    });

    futures::future::join_all(futures).await;

    result
}

fn get_word_url(search_word: &str, page_html: &str) -> Option<String> {
    let dom = tl::parse(page_html, tl::ParserOptions::default()).unwrap();
    let parser = dom.parser();

    let rows = dom.query_selector("tr").expect("Failed to find element");

    for row in rows {
        let row_html = row.get(parser).unwrap().inner_html(parser);
        let row_dom = tl::parse(&row_html, tl::ParserOptions::default()).unwrap();
        let row_parser = row_dom.parser();

        if row_html.contains("Adam Sheik") {
            continue;
        }

        let first_cell = row_dom
            .query_selector("td")
            .expect("Failed to find element");
        let mut word_link: Option<String> = None;

        for cell in first_cell {
            let cell_html = cell.get(row_parser).unwrap().inner_html(row_parser);
            let cell_text = cell.get(row_parser).unwrap().inner_text(row_parser);
            let cell_text_parsed = cell_text.replace("\\n", "");

            if word_link.is_some() && cell_text_parsed.trim() == search_word {
                return word_link;
            }

            if word_link.is_none() {
                let cell_dom = tl::parse(&cell_html, tl::ParserOptions::default()).unwrap();
                let cell_parser = cell_dom.parser();

                let links = cell_dom
                    .query_selector("a")
                    .expect("Failed to find element");

                for link in links {
                    let link_text = link.get(cell_parser).unwrap().inner_html(cell_parser);
                    if link_text.contains("http://www.cantonese.sheik.co.uk/images/icons/book.gif")
                    {
                        word_link = link.get(cell_parser).unwrap().as_tag().map(|tag| {
                            let href_attr = tag.attributes().get("href").flatten().unwrap();

                            href_attr.as_utf8_str().to_string()
                        });
                    }
                }
            }
        }
    }

    None
}

fn get_definitions(page_html: &str) -> Option<String> {
    let dom = tl::parse(page_html, tl::ParserOptions::default()).unwrap();
    let parser = dom.parser();

    let mut result = None;
    let definitions = dom
        .query_selector(".wordmeaning")
        .expect("Failed to find element");

    let re1 = Regex::new(r"Level: .*").unwrap();
    let re2 = Regex::new(r"Google Frequency: .*").unwrap();

    for definition in definitions {
        let mut inner_str = result.as_ref().unwrap_or(&"".to_string()).clone();
        let definition_text = definition.get(parser).unwrap().inner_text(parser);
        let definition_text = definition_text.replace("\n", "");
        let definition_text = definition_text
            .replace("\\n", "")
            .replace("Additional PoS:", "");
        let definition_text = definition_text.trim();
        let definition_text = re1.replace_all(definition_text, "");
        let definition_text = re2.replace_all(&definition_text, "");

        inner_str.push_str(&definition_text);
        result = Some(inner_str);
    }

    result
}

#[cfg(test)]
mod tests {
    use super::*;

    const EXAMPLE_PAGE: &str = r###"
\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">\n<html>\n<head>\n<meta name="author" content="Adam Sheik - Celerity Design">\n<meta name="description" content="CantoDict: an Online Collaborative Chinese (Cantonese) Dictionary.">\n<meta name="keywords"\ncontent="cantonese, chinese, mandarin, dictionary, traditional, characters, lessons,\neducational, putonghua, reference, words, translation, translations, translate, english">\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n\n\n\n<title>Search - CantoDict</title>\n<link rel="stylesheet" type="text/css" href="http://www.cantonese.sheik.co.uk/cantonese.css">\n<link rel="stylesheet" type="text/css" href="http://www.cantonese.sheik.co.uk/cantodict.css">\n<link rel="stylesheet" media="print" type="text/css" href="http://www.cantonese.sheik.co.uk/print.css">\n<link rel="shortcut icon" href="http://www.cantodict.com/favicon.ico">\n<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>\n<script type="text/javascript" src="./javascript/overlibmws.js"></script>\n<script type="text/javascript" src="./javascript/overlibdefaults.js"></script>\n<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">\n</script>\n<script type="text/javascript">\n_uacct = "UA-125239-2";\nurchinTracker();\n</script>\n</head>\n<body>\n<div id="container">\n<table width="100%" id="topnav class="nopad">\n<tr>\n\t<td width="40%" valign="top" class="nopad">&nbsp;</td>\n\t<td valign="middle" align="center" class="nopad">\n\t\t<a href="/"><img align="center" src="http://www.cantonese.sheik.co.uk/images/icons/home.gif" alt="Home" title="'sau2 jip6' - Back to the main 'Learn Chinese' website" border="0"></a>\n\t\t<br/>\n\t</td>\n\t<td width="40%" valign="top" class="nopad">\n\t\t<a href="/dictionary/"><img class="noborder" hspace="0" align="right" src="http://www.cantonese.sheik.co.uk/images/cantodict/cantodict_nav_1_home.gif" alt="CantoDict Home" title="CantoDict Home"></a><a href="/donate.htm#customise"><img class="noborder" align="right" src="http://www.cantonese.sheik.co.uk/images/cantodict/cantodict_nav_2_customise.gif" hspace="0" alt="CantoDict Settings" title="Customise CantoDict, change settings etc"></a>\n\t</td>\n</tr>\n<tr>\n\t<td colspan="3" align="center" class="nopad">\n\t\t<div class="topnav">\n<br/>\n<a href="/scripts/masterlist.htm">Characters</a> |\n<a href="/dictionary/words/">Words</a> |\n<a href="/scripts/examplelist.htm">Sentences</a> |\n<a href="/dictionary/parser/">Chinese Translation</a> |\n<a href="/tests/">Chinese Tests</a> |\n<a href="/phorum/">Forums</a> |\n<a href="/scripts/wordsearch.php"><b>Search</b></a>\n<br/>\n<small>\n\n\n<a href="/donate.htm#customise">Customise CantoDict</a> | <a href="/scripts/vocablist.php">My Vocab Lists</a> | <a href="/scripts/dbstats.htm">Useful Reports and Stats</a> |\n<a href="/phorum/list.php?14">CantoDict Forum</a>\n</small>\n</div>\n\t</td>\n</tr>\n</table>\n\n\t<center>\n\t<div class="noprint">\n\t<small><a href="http://www.cantonese.sheik.co.uk/donate.htm#subscribe">Remove Adverts and gain lots of extra features</a></small>\n\t<br/>\n\t<script type="text/javascript"><!--\n\tgoogle_ad_client = "pub-7666422977838952";\n\tgoogle_ad_width = 728;\n\tgoogle_ad_height = 90;\n\tgoogle_ad_format = "728x90_as";\n\tgoogle_ad_type = "text_image";\n\tgoogle_ad_channel ="7359994566";\n\tgoogle_color_border = "990000";\n\tgoogle_color_bg = "FFFFFF";\n\tgoogle_color_link = "006633";\n\tgoogle_color_url = "FF0000";\n\tgoogle_color_text = "000000";\n\t//--></script>\n\t<script type="text/javascript"\n\t  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">\n\t</script>\n\t</div>\n\t</center>\n\n    \t<div class="normalpage">\n<h2 align="center">Dictionary Search</h2>\n\t<p>\n\tThis dictionary is a collaborative project started in November 2003. Entries are added and mistakes corrected by a team of volunteers from around the world.\n\t<br/>\n\tIf you can spare even ten minutes a week to help with this project then please\n\t<a href="http://www.cantonese.sheik.co.uk/phorum/read.php?f=1&i=6727&t=6727">volunteer.</a> Editing is easy, you just use your web browser!\n\t</p>\n\t<div align="center">\n<div id="searchbox">\n<form class="searchbox" action="http://www.cantonese.sheik.co.uk/scripts/wordsearch.php?level=0" method="post" name="searchform">\nSearch CantoDict\n <small>(<a href="http://www.cantodict.org/safesearch.htm" target="_blank">safe search</a> is on)</small>\n<br/>\n<input size="13" class="cantodict_search_input" type="text" name="TEXT" value="心中">\n<select class="cantodict_search_input" name="SEARCHTYPE" onchange="disableButton();">\n<option  value="4">English meaning</option>\n<option  value="2">Chinese Character</option>\n<option selected value="1">Chinese Word</option>\n<option  value="6">Chinese Word (initial)</option>\n<option  value="7">Chinese Word (final)</option>\n<option  value="3">Jyutping (Cantonese)</option>\n<option  value="5">Pinyin (Mandarin)</option>\n<option  value="8">Radical</option>\n<option  value="11">Unicode value</option>\n<optgroup label="Search Example Sentences">\n\t<option  value="12">Meaning of sentence</option>\n\n</optgroup>\n</select>\n<select name="radicaldropdown" style="display:inline; font-family: 'arial unicode MS',MingLiu" class="radicaldropdown">\n<option selected value="0"></option>\n<optgroup label="1 stroke">\n<option value="1">1: &#19968; (one)</option>\n<option value="2">2: &#20008; (line)</option>\n<option value="3">3: &#20022; (dot)</option>\n<option value="4">4: &#20031; (slash)</option>\n<option value="5">5: &#20057; or &#20058; (second)</option>\n<option value="6">6: &#20101; (hook)</option>\n</optgroup>\n<optgroup label="2 strokes">\n<option value="7">7: &#20108; (two)</option>\n<option value="8">8: &#20128; (lid)</option>\n<option value="9">9: &#20155; or &#20154; (man)</option>\n<option value="10">10: &#20799; (legs)</option>\n<option value="11">11: &#20837; (enter)</option>\n<option value="12">12: &#20843; (eight)</option>\n<option value="13">13: &#20866; (down box)</option>\n<option value="14">14: &#20886; (cover)</option>\n<option value="15">15: &#20907; (ice)</option>\n<option value="16">16: &#20960; (table)</option>\n<option value="17">17: &#20981; (open box)</option>\n<option value="18">18: &#20992; or &#20994; (knife)</option>\n<option value="19">19: &#21147; (power)</option>\n<option value="20">20: &#21241; (wrap)</option>\n<option value="21">21: &#21269; (spoon)</option>\n<option value="22">22: &#21274; (right open box)</option>\n<option value="23">23: &#21304; (hiding enclosure)</option>\n<option value="24">24: &#21313; (ten)</option>\n<option value="25">25: &#21340; (divination)</option>\n<option value="26">26: &#21353; (seal)</option>\n<option value="27">27: &#21378; (cliff)</option>\n<option value="28">28: &#21430; (private)</option>\n<option value="29">29: &#21448; (again)</option>\n</optgroup>\n<optgroup label="3 strokes">\n<option value="30">30: &#21475; (mouth)</option>\n<option value="31">31: &#22231; (enclosure)</option>\n<option value="32">32: &#22303; (earth)</option>\n<option value="33">33: &#22763; (scholar)</option>\n<option value="34">34: &#22786; (go)</option>\n<option value="35">35: &#22794; (go slowly)</option>\n<option value="36">36: &#22805; (evening)</option>\n<option value="37">37: &#22823; (big)</option>\n<option value="38">38: &#22899; (woman)</option>\n<option value="39">39: &#23376; (child)</option>\n<option value="40">40: &#23424; (roof)</option>\n<option value="41">41: &#23544; (inch)</option>\n<option value="42">42: &#23567; (small)</option>\n<option value="43">43: &#23586; (lame)</option>\n<option value="44">44: &#23608; (corpse)</option>\n<option value="45">45: &#23662; (sprout)</option>\n<option value="46">46: &#23665; (mountain)</option>\n<option value="47">47: &#24029; or &#24027; (river)</option>\n<option value="48">48: &#24037; (work)</option>\n<option value="49">49: &#24049; (oneself)</option>\n<option value="50">50: &#24062; (turban)</option>\n<option value="51">51: &#24178; (dry)</option>\n<option value="52">52: &#24186; (tiny)</option>\n<option value="53">53: &#24191; (house on cliff)</option>\n<option value="54">54: &#24308; (long stride)</option>\n<option value="55">55: &#24318; (two hands)</option>\n<option value="56">56: &#24331; (shoot)</option>\n<option value="57">57: &#24339; (bow)</option>\n<option value="58">58: &#24400; or &#24401; (snout)</option>\n<option value="59">59: &#24417; (bristle)</option>\n<option value="60">60: &#24435; (step)</option>\n</optgroup>\n<optgroup label="4 strokes">\n<option value="61">61: &#24515; or &#24516; (heart)</option>\n<option value="62">62: &#25096; (halberd)</option>\n<option value="63">63: &#25142; (door)</option>\n<option value="64">64: &#25164; or &#25903; (hand)</option>\n<option value="65">65: &#25903; (branch)</option>\n<option value="66">66: &#25908; or &#25909; (rap)</option>\n<option value="67">67: &#25991; (script)</option>\n<option value="68">68: &#26007; (dipper)</option>\n<option value="69">69: &#26020; (axe)</option>\n<option value="70">70: &#26041; (square)</option>\n<option value="71">71: &#26080; or &#26081; (not)</option>\n<option value="72">72: &#26085; (sun)</option>\n<option value="73">73: &#26352; (say)</option>\n<option value="74">74: &#26376; (moon)</option>\n<option value="75">75: &#26408; (tree)</option>\n<option value="76">76: &#27424; (yawn)</option>\n<option value="77">77: &#27490; (stop)</option>\n<option value="78">78: &#27513; or &#27514; (death)</option>\n<option value="79">79: &#27571; (weapon)</option>\n<option value="80">80: &#27595; or &#27597;(do not)</option>\n<option value="81">81: &#27604; (compare)</option>\n<option value="82">82: &#27611; (fur)</option>\n<option value="83">83: &#27663; (clan)</option>\n<option value="84">84: &#27668; (steam)</option>\n<option value="85">85: &#27700;,&#27701; or &#27706; (water)</option>\n<option value="86">86: &#28779; or &#28780; (fire)</option>\n<option value="87">87: &#29226; or &#29227; (claw)</option>\n<option value="88">88: &#29238; (father)</option>\n<option value="89">89: &#29243; (double crosses)</option>\n<option value="90">90: &#29247;/&#20012; (bed)</option>\n<option value="91">91: &#29255; (slice)</option>\n<option value="92">92: &#29273; (fang)</option>\n<option value="93">93: &#29275; (cow)</option>\n<option value="94">94: &#29356; or &#29357;(dog)</option>\n</optgroup>\n<optgroup label="5 strokes">\n<option value="95">95: &#29572; (profound)</option>\n<option value="96">96: &#29577; or &#29579; (jade)</option>\n<option value="97">97: &#29916; (melon)</option>\n<option value="98">98: &#29926; (earthenware)</option>\n<option value="99">99: &#29976; (sweet)</option>\n<option value="100">100: &#29983; (life)</option>\n<option value="101">101: &#29992; (use)</option>\n<option value="102">102: &#30000; (field)</option>\n<option value="103">103: &#30091; (bolt of cloth)</option>\n<option value="104">104: &#30098; (sickness)</option>\n<option value="105">105: &#30326; (dotted tent)</option>\n<option value="106">106: &#30333; (white)</option>\n<option value="107">107: &#30382; (skin)</option>\n<option value="108">108: &#30399; (dish)</option>\n<option value="109">109: &#30446; (eye)</option>\n<option value="110">110: &#30683; (halberd)</option>\n<option value="111">111: &#30690; (arrow)</option>\n<option value="112">112: &#30707; (stone)</option>\n<option value="113">113: &#31034; or &#31035; (spirit)</option>\n<option value="114">114: &#31160; (track)</option>\n<option value="115">115: &#31166; (grain)</option>\n<option value="116">116: &#31348; (cave)</option>\n<option value="117">117: &#31435; (stand)</option>\n</optgroup>\n<optgroup label="6 strokes">\n<option value="118">118: &#31481; (bamboo)</option>\n<option value="119">119: &#31859; (rice)</option>\n<option value="120">120: &#31992;/&#32415; or &#31993; (silk)</option>\n<option value="121">121: &#32566; (jar)</option>\n<option value="122">122: &#32593; or &#32594; (net)</option>\n<option value="123">123: &#32650; (sheep)</option>\n<option value="124">124: &#32701; (feather)</option>\n<option value="125">125: &#32769; or &#32770; (old)</option>\n<option value="126">126: &#32780; (and)</option>\n<option value="127">127: &#32786; (plow)</option>\n<option value="128">128: &#32819; (ear)</option>\n<option value="129">129: &#32895; (brush)</option>\n<option value="130">130: &#32905; (meat)</option>\n<option value="131">131: &#33251; (minister)</option>\n<option value="132">132: &#33258; (self)</option>\n<option value="133">133: &#33267; (arrive)</option>\n<option value="134">134: &#33276; (mortar)</option>\n<option value="135">135: &#33292; (tongue)</option>\n<option value="136">136: &#33307; (oppose)</option>\n<option value="137">137: &#33311; (boat)</option>\n<option value="138">138: &#33390; (stopping)</option>\n<option value="139">139: &#33394; (color)</option>\n<option value="140">140: &#33400; or &#33401; (grass)</option>\n<option value="141">141: &#34381; (tiger)</option>\n<option value="142">142: &#34411; (insect)</option>\n<option value="143">143: &#34880; (blood)</option>\n<option value="144">144: &#34892; (walk)</option>\n<option value="145">145: &#34915; or &#34916; (clothes)</option>\n<option value="146">146: &#35199; or &#35200; or &#35198; (west)</option>\n</optgroup>\n<optgroup label="7 strokes">\n<option value="147">147: &#35211;/&#35265; (see)</option>\n<option value="148">148: &#35282; (horn)</option>\n<option value="149">149: &#35328 or &#35329;/&#35744; (speech)</option>\n<option value="150">150: &#35895; (valley)</option>\n<option value="151">151: &#35910; (bean)</option>\n<option value="152">152: &#35925; (pig)</option>\n<option value="153">153: &#35960; (badger)</option>\n<option value="154">154: &#35997;/&#36125; (shell)</option>\n<option value="155">155: &#36196; (red)</option>\n<option value="156">156: &#36208; (run)</option>\n<option value="157">157: &#36275; (foot)</option>\n<option value="158">158: &#36523; (body)</option>\n<option value="159">159: &#36554;/&#36710; (car)</option>\n<option value="160">160: &#36763; (bitter)</option>\n<option value="161">161: &#36784; (morning)</option>\n<option value="162">162: &#36789; or &#36790; (walk)</option>\n<option value="163">163: &#37009; (city)</option>\n<option value="164">164: &#37193; (wine)</option>\n<option value="165">165: &#37318; (distinguish)</option>\n<option value="166">166: &#37324; (village)</option>\n</optgroup>\n<optgroup label="8 strokes">\n<option value="167">167: &#37329; or &#37330;/&#38021; (metal)</option>\n<option value="168">168: &#38263;/&#38271; or &#38264; (long)</option>\n<option value="169">169: &#38272;/&#38376; (gate)</option>\n<option value="170">170: &#38428; or &#38429; (mound)</option>\n<option value="171">171: &#38582; (slave)</option>\n<option value="172">172: &#38585; (small bird)</option>\n<option value="173">173: &#38632; (rain)</option>\n<option value="174">174: &#38737; or &#38738; (blue)</option>\n<option value="175">175: &#38750; (wrong)</option>\n</optgroup>\n<optgroup label="9 strokes">\n<option value="176">176: &#38754; (face)</option>\n<option value="177">177: &#38761; (leather)</option>\n<option value="178">178: &#38859;/&#38886; (tanned leather)</option>\n<option value="179">179: &#38893; (leek)</option>\n<option value="180">180: &#38899; (sound)</option>\n<option value="181">181: &#38913;/&#39029; (face)</option>\n<option value="182">182: &#39080;/&#39118; (wind)</option>\n<option value="183">183: &#39131;/&#39134; (fly)</option>\n<option value="184">184: &#39135; or &#39136;/&#39267; (eat)</option>\n<option value="185">185: &#39318; (head)</option>\n<option value="186">186: &#39321; (fragrant)</option>\n</optgroup>\n<optgroup label="10 strokes">\n<option value="187">187: &#39340;/&#39532; (horse)</option>\n<option value="188">188: &#39592; (bone)</option>\n<option value="189">189: &#39640; (tall)</option>\n<option value="190">190: &#39647; (hair)</option>\n<option value="191">191: &#39717; (fight)</option>\n<option value="192">192: &#39727; (sacrificial wine)</option>\n<option value="193">193: &#39730; (cauldron)</option>\n<option value="194">194: &#39740; (ghost)</option>\n</optgroup>\n<optgroup label="11 strokes">\n<option value="195">195: &#39770;/&#40060; (fish)</option>\n<option value="196">196: &#40165;/&#40479; (bird)</option>\n<option value="197">197: &#40565; (alkaline)</option>\n<option value="198">198: &#40575; (deer)</option>\n<option value="199">199: &#40613;/&#40614; (wheat)</option>\n<option value="200">200: &#40635; (hemp)</option>\n</optgroup>\n<optgroup label="12 strokes">\n<option value="201">201: &#40643; (yellow)</option>\n<option value="202">202: &#40653; (millet)</option>\n<option value="203">203: &#40657; (black)</option>\n<option value="204">204: &#40697; (needlework)</option>\n</optgroup>\n<optgroup label="13 strokes">\n<option value="205">205: &#40701;/&#40702; (amphibian)</option>\n<option value="206">206: &#40718; (tripod)</option>\n<option value="207">207: &#40723; (drum)</option>\n<option value="208">208: &#40736; (rat)</option>\n</optgroup>\n<optgroup label="14 strokes">\n<option value="209">209: &#40763; (nose)</option>\n<option value="210">210: &#40778;/&#40784; or &#25993; (uniformly)</option>\n</optgroup>\n<optgroup label="15 strokes">\n<option value="211">211: &#40786;/&#40831; or &#27503; (tooth)</option>\n</optgroup>\n<optgroup label="16 strokes">\n<option value="212">212: &#40845;/&#40857; or &#31452; (dragon)</option>\n<option value="213">213: &#40860;/&#40863;/&#20096; (tortoise)</option>\n</optgroup>\n<optgroup label="17 strokes">\n<option value="214">214: &#40864; (flute)</option>\n</optgroup>\n</select>\n\n\t\n<input type="submit" value="search" name="searchsubmit" title="This is the normal search, and should be used by default.">\n<input type="submit" value="full search" name="searchsubmitfull" title="This option will return more results, some of which may not be as relevant to your query.">\n<br/>\n<div id="search_info_label" style="display: block">\nPlease note, CantoDict currently supports searching for Simplified Chinese, but results will be returned in Traditional Chinese.\n</div>\n<label for="HIDEWRITTENANDSPOKEN">Hide Written and Spoken</label> <input  type="checkbox" name="HIDEWRITTENANDSPOKEN" id="HIDEWRITTENANDSPOKEN">\n<label for="HIDEWRITTEN">Hide Written <a title='Mandarin / Standard written Chinese only.'><span class='mandarinbox'>&#22283;</span></a></label> <input  type="checkbox" name="HIDEWRITTEN" id="HIDEWRITTEN">\n<label for="HIDECANTONESE">Hide Spoken<a title='Cantonese only, (usually spoken but can be written)'><span class='cantonesebox'>&#31925;</span></a></label> <input  type="checkbox" name="HIDECANTONESE" id="HIDECANTONESE">\n</form>\n</div>\n\t<script language="javascript">\n\t\tfunction disableButton(){\n\t\t\tvar searchType;\n\t\t\tsearchType = document.searchform.SEARCHTYPE.options[document.searchform.SEARCHTYPE.selectedIndex].value;\n\t\t\tif (searchType != 4){\n\t\t\t\tdocument.searchform.searchsubmitfull.disabled = true;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tdocument.searchform.searchsubmitfull.disabled = false;\n\t\t\t}\n\n\t\t\tif (searchType != 8 ){\n\t\t\t\tdocument.searchform.radicaldropdown.style.display="none";\n\t\t\t\tdocument.searchform.TEXT.disabled = false;\n\t\t\t\tdocument.searchform.TEXT.style.display = "inline";\n\t\t\t}\n\t\t\telse{\n\t\t\t\tdocument.searchform.radicaldropdown.style.display="inline";\n\t\t\t\tdocument.searchform.TEXT.disabled=true;\n\t\t\t\tdocument.searchform.TEXT.style.display = "none";\n\t\t\t}\nif ((searchType == 2) || (searchType == 6) || (searchType == 7)){\ndocument.searchform.TEXT.size=13;\n}\nelse if (searchType == 1){\ndocument.searchform.TEXT.size=13;\n}\nelse{\ndocument.searchform.TEXT.size=16;\n}\nif ((searchType == 2) || (searchType == 1) || (searchType == 7) || (searchType == 6)){\ndocument.searchform.TEXT.style.fontFamily="MingLiu";\ndocument.searchform.TEXT.style.fontSize="12pt";\n}\nelse{\ndocument.searchform.TEXT.style.fontFamily="";\ndocument.searchform.TEXT.style.fontSize="";\n}\nif ((searchType == 3) || (searchType == 5)){\ndocument.searchform.TEXT.style.fontStyle="italic";\n}\nelse{\ndocument.searchform.TEXT.style.fontStyle="normal";\n}\nif (searchType == 5){\ndocument.getElementById("search_info_label").innerHTML = 'CantoDict uses separate pinyin syllables with spaces and (optional) tone numbers:  eg: <i>ni hao</i> or <i>ni3 hao3.</i> <a href="http://www.cantonese.sheik.co.uk/phorum/read.php?14,66044,66044" target="_blank">More information...</a>';\n}\nelse if (searchType == 3){\ndocument.getElementById("search_info_label").innerHTML = 'For help, please see our <a href="http://www.cantonese.sheik.co.uk/phorum/read.php?14,66046" target="_blank">Jyutping guide.</a>';\n}\nelse if (searchType == 1){\ndocument.getElementById("search_info_label").innerHTML = 'Wildcard searching is supported:  eg: <font color="blue">*&#37941;*&#37341;*</font> &nbsp; <a href="http://www.cantonese.sheik.co.uk/phorum/read.php?14,56845" target="_blank">More information...</a>';\n}\nelse if (searchType == 11){\ndocument.getElementById("search_info_label").innerHTML = 'i.e. U+xxxx';\n}\nelse{\ndocument.getElementById("search_info_label").innerHTML = "Please note, CantoDict currently supports searching for Simplified Chinese, but results will be returned in Traditional Chinese.";\n}\n}\ndisableButton()\n</script>\n</div>\n<table class="border valign" cellpadding="0" cellspacing="0" width="95%" align="center">\n<tr>\n<td colspan="5">\n<b>Found 4 word entries for "心中"</b>\n<br/><small>Link to this search: <a href="http://www.cantonese.sheik.co.uk/dictionary/search/?searchtype=1&text=%E5%BF%83%E4%B8%AD">http://www.cantonese.sheik.co.uk/dictionary/search/?searchtype=1&text=%E5%BF%83%E4%B8%AD</a> </td>\n</tr>\n<tr><td colspan="5"></td>\n</tr>\n<tr><td width="3%"></td><td width="22%"><b>Word</b></td><td width="18%"><b>jyutping</b></td><td width="18%"><b>pinyin</b></td><td width="*"><b>Meaning</b></td></tr>\n<tr>\n<td><a href="http://www.cantonese.sheik.co.uk/dictionary/words/13127/"><img src="http://www.cantonese.sheik.co.uk/images/icons/book.gif" border="0" align="absmiddle" hspace="2" vspace="3" alt="desc">\n</a></td>\n<td><span class="chinesemed"><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/86/" class="linkchar">心</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/62/" class="linkchar">中</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/128/" class="linkchar">有</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/418/" class="linkchar">數</a></span>\n</td>\n<td valign="top"><span class="listjyutping">sam<span class="tone">1</span> zung<span class="tone">1</span> jau<span class="tone">5</span> sou<span class="tone">3</span></span></td>\n<td valign="top"><span class="listpinyin"></span></td>\n<td> &nbsp; know fairly well </td>\n</tr>\n<tr>\n<td><a href="http://www.cantonese.sheik.co.uk/dictionary/words/6600/"><img src="http://www.cantonese.sheik.co.uk/images/icons/book.gif" border="0" align="absmiddle" hspace="2" vspace="3" alt="desc">\n</a></td>\n<td><span class="chinesemed"><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/86/" class="linkchar">心</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/62/" class="linkchar">中</a></span>\n</td>\n<td valign="top"><span class="listjyutping">sam<span class="tone">1</span> zung<span class="tone">1</span></span></td>\n<td valign="top"><span class="listpinyin">xin<span class="tone">1</span> zhong<span class="tone">1</span></span></td>\n<td> &nbsp; in one's heart </td>\n</tr>\n<tr>\n<td><a href="http://www.cantonese.sheik.co.uk/dictionary/words/30067/"><img src="http://www.cantonese.sheik.co.uk/images/icons/book.gif" border="0" align="absmiddle" hspace="2" vspace="3" alt="desc">\n</a></td>\n<td><span class="chinesemed"><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/86/" class="linkchar">心</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/62/" class="linkchar">中</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/128/" class="linkchar">有</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/654/" class="linkchar">鬼</a></span>\n</td>\n<td valign="top"><span class="listjyutping">sam<span class="tone">1</span> zung<span class="tone">1</span> jau<span class="tone">5</span> gwai<span class="tone">2</span></span></td>\n<td valign="top"><span class="listpinyin"></span></td>\n<td> &nbsp; to have a guilty conscience </td>\n</tr>\n<tr>\n<td><a href="http://www.cantonese.sheik.co.uk/dictionary/words/59850/"><img src="http://www.cantonese.sheik.co.uk/images/icons/book.gif" border="0" align="absmiddle" hspace="2" vspace="3" alt="desc">\n</a></td>\n<td><span class="chinesemed"><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/86/" class="linkchar">心</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/62/" class="linkchar">中</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/128/" class="linkchar">有</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/1943/" class="linkchar">愧</a></span>\n</td>\n<td valign="top"><span class="listjyutping">sam<span class="tone">1</span> zung<span class="tone">1</span> jau<span class="tone">5</span> kwai<span class="tone">5</span></span></td>\n<td valign="top"><span class="listpinyin">xin<span class="tone">1</span> zhong<span class="tone">1</span> you<span class="tone">3</span> kui<span class="tone">4</span></span></td>\n<td> &nbsp; to feel ashamed; have a guilty conscience </td>\n</tr>\n</table>\n<div align="center">\n\n\t<script type="text/javascript"><!--\n\tgoogle_ad_client = "pub-7666422977838952";\n\tgoogle_ad_width = 728;\n\tgoogle_ad_height = 90;\n\tgoogle_ad_format = "728x90_as";\n\tgoogle_ad_type = "text_image";\n\tgoogle_ad_channel ="";\n\tgoogle_color_border = "990000";\n\tgoogle_color_bg = "FFFFFF";\n\tgoogle_color_link = "006633";\n\tgoogle_color_url = "FF0000";\n\tgoogle_color_text = "000000";\n\t//--></script>\n\t<script type="text/javascript"\n\t  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">\n\t</script>\n</div>\n<table class="border valign" cellpadding="0" cellspacing="0" width="95%" align="center">\n<tr>\n<td colspan="3">\n<b>No Chinese Examples were found for "心中"</b>\n</td>\n</tr>\n</table>\n<table class="border valign" cellpadding="0" cellspacing="0" width="95%" align="center">\n</table>\n<p> </p>\n\n</div>\n<center>\n<span class="scripttime">Script executed in 0.015668 secs</span>\n\n\n\t<div class="sponsorfooter"  >\nSponsors:\n\n\t\t<a href="http://www.publicchinese.com/oneonone/" title="Without stepping out of your house, you can have a native Chinese as your tutor." target="_blank">One-on-One Online Chinese Tutoring</a>\n\t\t| \n\t\t<a href="http://www.instantspeakchinese.com" target="_blank">Mandarin</a> | <a href="http://www.instantspeakspanish.com" target="_blank">Learn Spanish</a>\n\t\t<br/><a href="http://www.chinese-forums.com/forumdisplay.php?f=25" target="_blank">Living in China</a>\n | <a href="http://www.learn-mandarin.net" target="_blank">Learn Chinese in China</a>\n | <a href="http://www.learn-mandarin.net/learn-mandarin-in-china" target="_blank">Learn Mandarin in China</a>\n | <a href="http://www.learn-mandarin.net/chinese-language-school" target="_blank">Chinese School</a>\n | <a href="http://www.chineselesson.co.uk" target="_blank">Mandarin lessons in London</a>\n\n</div>\n\n\t<div class="dictionarycredits" >\n\t\t<a href="http://www.cantonese.sheik.co.uk/donate.htm"><img src="http://www.cantonese.sheik.co.uk/images/donate.png" alt="Donate to CantoDict" border="0" vspace="4"></a>\n\t<br/>\n\t\t<a href="http://www.cantodict.org" target="_blank">CantoDict</a> <a href="/phorum/read.php?14,85264,gotonewpost" target="_blank">v1.4.2</a> is a collaborative Chinese Dictionary project started in November 2003. Entries are added and mistakes corrected by a team of kind <a href="http://www.cantonese.sheik.co.uk/scripts/editors.htm">volunteers</a> from around the world. <br/>\n\t<a href="http://www.cantonese.sheik.co.uk/copyright.htm">Copyright</a> Adam Sheik 2003-2024.\n\t</div>\n\t</center>\n
    "###;
    const EXAMPLE_DETAIL_PAGE: &str = r###"
"\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">\n<html>\n<head>\n<meta name="author" content="Adam Sheik - Celerity Design">\n<meta name="description" content="CantoDict: an Online Collaborative Chinese (Cantonese) Dictionary.">\n<meta name="keywords"\ncontent="cantonese, chinese, mandarin, dictionary, traditional, characters, lessons,\neducational, putonghua, reference, words, translation, translations, translate, english">\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n\n\n\n<title>&#20559;&#20559; (pin1 pin1 | pian1 pian1) : unfortunately; something other than expected - CantoDict</title>\n<link rel="stylesheet" type="text/css" href="http://www.cantonese.sheik.co.uk/cantonese.css">\n<link rel="stylesheet" type="text/css" href="http://www.cantonese.sheik.co.uk/cantodict.css">\n<link rel="stylesheet" media="print" type="text/css" href="http://www.cantonese.sheik.co.uk/print.css">\n<link rel="shortcut icon" href="http://www.cantodict.com/favicon.ico">\n<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>\n<script type="text/javascript" src="http://www.cantonese.sheik.co.uk/scripts/javascript/overlibmws.js"></script>\n<script type="text/javascript" src="http://www.cantonese.sheik.co.uk/scripts/javascript/overlibdefaults.js"></script>\n\n<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">\n</script>\n<script type="text/javascript">\n_uacct = "UA-125239-2";\nurchinTracker();\n</script>\n</head>\n<body>\n<div id="container">\n<table width="100%" id="topnav class="nopad">\n<tr>\n\t<td width="40%" valign="top" class="nopad">&nbsp;</td>\n\t<td valign="middle" align="center" class="nopad">\n\t\t<a href="/"><img align="center" src="http://www.cantonese.sheik.co.uk/images/icons/home.gif" alt="Home" title="'sau2 jip6' - Back to the main 'Learn Chinese' website" border="0"></a>\n\t\t<br/>\n\t</td>\n\t<td width="40%" valign="top" class="nopad">\n\t\t<a href="/dictionary/"><img class="noborder" hspace="0" align="right" src="http://www.cantonese.sheik.co.uk/images/cantodict/cantodict_nav_1_home.gif" alt="CantoDict Home" title="CantoDict Home"></a><a href="/donate.htm#customise"><img class="noborder" align="right" src="http://www.cantonese.sheik.co.uk/images/cantodict/cantodict_nav_2_customise.gif" hspace="0" alt="CantoDict Settings" title="Customise CantoDict, change settings etc"></a>\n\t</td>\n</tr>\n<tr>\n\t<td colspan="3" align="center" class="nopad">\n\t\t<div class="topnav">\n<br/>\n<a href="/scripts/masterlist.htm">Characters</a> |\n<a href="/dictionary/words/">Words</a> |\n<a href="/scripts/examplelist.htm">Sentences</a> |\n<a href="/dictionary/parser/">Chinese Translation</a> |\n<a href="/tests/">Chinese Tests</a> |\n<a href="/phorum/">Forums</a> |\n<a href="/scripts/wordsearch.php"><b>Search</b></a>\n<br/>\n<small>\n\n\n<a href="/donate.htm#customise">Customise CantoDict</a> | <a href="/scripts/vocablist.php">My Vocab Lists</a> | <a href="/scripts/dbstats.htm">Useful Reports and Stats</a> |\n<a href="/phorum/list.php?14">CantoDict Forum</a>\n</small>\n</div>\n\t</td>\n</tr>\n</table>\n\n\n\n<br/>\n<div align="center">\n<center>\n\t<center>\n\t<small><a href="http://www.cantonese.sheik.co.uk/donate.htm#subscribe">Remove Adverts and gain lots of extra features</a></small>\n\t<br/>\n\t<script type="text/javascript"><!--\n\tgoogle_ad_client = "pub-7666422977838952";\n\tgoogle_ad_width = 468;\n\tgoogle_ad_height = 60;\n\tgoogle_ad_format = "468x60_as";\n\tgoogle_ad_channel ="7359994566";\n\tgoogle_color_border = ["990000","A8DDA0","DDB7BA"];\n\tgoogle_color_bg = ["FFFFFF","EBFFED","FFF5F6"];\n\tgoogle_color_link = ["006633","0000CC","0000CC"];\n\tgoogle_color_url = ["FF0000","008000","008000"];\n\tgoogle_color_text = ["000000","6F6F6F","6F6F6F"];\n\t//--></script>\n\t<script type="text/javascript"\n\t  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">\n\t</script>\n\t</center>\n\n    \t\n<small><a href="#info">What is this page showing me?</a><br/><br/></small>\n            <!-- google_ad_section_start -->\n            <table align="center" class="cardborder wordcard">\n            <tr>\n                <td align="center">\n                    <span class="word script">偏偏</span>\n                    <br/>\n<img src="http://www.cantonese.sheik.co.uk/images/cantodict/spacer.png" hspace="10" width="50" height="1">\n &nbsp; <span class="cardjyutping">pin<span class="tone">1</span> pin<span class="tone">1</span></span> &nbsp; \n<a href="#jyutpinginfo"><img align="absmiddle" src="http://www.cantonese.sheik.co.uk/images/cantodict/label_jyutping.png" alt="jyutping" title="jyutping" hspace="10" vspace="2" border="0"></a>\n<br/>\n<img src="http://www.cantonese.sheik.co.uk/images/cantodict/spacer.png" hspace="10" width="50" height="1">\n &nbsp; <span class="cardpinyin">pian<span class="tone">1</span> pian<span class="tone">1</span></span> &nbsp; \n<a href="#jyutpinginfo"><img align="absmiddle" src="http://www.cantonese.sheik.co.uk/images/cantodict/label_pinyin.png" alt="pinyin" title="pinyin" hspace="10" vspace="2" border="0"></a>\n                </td>\n            </tr>\n            <tr>\n                <td align="center" class="wordmeaning">\n                     <div>[1] just [2] but [3] only [4] wilfully; insistently; persistently [5] contrary to expectations [6] unfortunately [7] perversely</div><br/>\n<div class="wordlevel"><br/>\nLevel: 3\n<small>&nbsp;&nbsp;Google Frequency: 2,700,000</small><br/>\n<br/>\n<span class="typedesc">This term is used in both Cantonese and Mandarin/Standard written Chinese. </span>\n                </td>\n            </tr>\n            <tr>\n                <td class="chinesebig" align="center">\n                    偏偏                </td>\n            </tr>\n            <tr>\n                <td align="center">\n            \t\t<br/>\n<span class="credits">This word has been viewed 1 times since 30th Oct 2012, was added by bybell on 23rd Aug 2005 05:20 and last <a href="http://www.cantonese.sheik.co.uk/scripts/editlog.htm?filter=偏偏" title="See list of all edits for this entry">edited</a> on 30th Oct 2008 19:03</span>\t\t\t\t</td>\n\t\t\t</tr>\n            <tr>\n            \t<td>\n            \t\t<table width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td align="left" width="50%">\n\t\t\t\t\t\t\t\tOutput this word as a <a href="http://www.cantonese.sheik.co.uk/scripts/render_word.php?id=9621">high resolution image</a>\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td align="right">\n\t\t\t\t\t\t\t\t<form name="addtovocab" action="?action=addtovocab" method="post">\nAdd to vocab list:\n<select name="vocablists">\n<option value="0">Create my first list</option>\n</select>\n<input type="submit" value="Add"/>\n</form>\n<form name="removefromvocab" action="?action=removefromvocab" method="post">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</td>\n\t\t\t</tr>\n\n            <tr>\n                <td>\n\t\t\t\t\t<hr/>\n<center>\nSponsors:\n\n\t\t<a href="http://www.publicchinese.com/oneonone/" title="Without stepping out of your house, you can have a native Chinese as your tutor." target="_blank">One-on-One Online Chinese Tutoring</a>\n\t\t| \n\t\t<a href="http://www.instantspeakchinese.com" target="_blank">Mandarin</a> | <a href="http://www.instantspeakspanish.com" target="_blank">Learn Spanish</a>\n\t\t<br/><a href="http://www.chinese-forums.com/forumdisplay.php?f=4" target="_blank">Chinese Language</a>\n | <a href="http://www.learn-mandarin.net" target="_blank">Learn Chinese in China</a>\n | <a href="http://www.learn-mandarin.net/learn-mandarin-in-china" target="_blank">Learn Mandarin in China</a>\n | <a href="http://www.learn-mandarin.net/chinese-language-school" target="_blank">Chinese School</a>\n | <a href="http://www.chineselesson.co.uk" target="_blank">Chinese Lessons in the UK</a>\n</center>\n<hr/>\n                    </td>\n</tr>\n<tr>\n<td class="white cantodictcharacterblock">\n<h4>Characters in this word:</h4><span class="chinesemed">\n<a href="http://www.cantonese.sheik.co.uk/dictionary/characters/1394/" class="linkchar">偏</a></span>\n &nbsp;<span class="summary_jyutping">pin<span class="tone">1</span></span>  &nbsp;-&nbsp; slanting; partial; deviate from; uncommon<br/>\n<span class="chinesemed">\n<a href="http://www.cantonese.sheik.co.uk/dictionary/characters/1394/" class="linkchar">偏</a></span>\n &nbsp;<span class="summary_jyutping">pin<span class="tone">1</span></span>  &nbsp;-&nbsp; slanting; partial; deviate from; uncommon<br/>\n\n                    <tr>\n<td class="white cantodictbg1">\n<h4>One Cantonese Homophone / Homophone Variant for this word:</h4><hr/>\n<a href="http://www.cantonese.sheik.co.uk/dictionary/words/38020/"><img src="http://www.cantonese.sheik.co.uk/images/icons/book.gif" border="0" align="absmiddle" hspace="2" vspace="3" alt="detail" title="Full Detail">\n</a> <span class="chinesemed"><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/8061/" class="linkchar">翩</a><a href="http://www.cantonese.sheik.co.uk/dictionary/characters/8061/" class="linkchar">翩</a></span>\n  &nbsp;<span class="summary_jyutping">pin1 pin1</span>   &nbsp;<span class="summary_pinyin">pian1 pian1</span>  = light (dance, flutter, etc.); elegant, lightly<br/>\n                </td>\n            </tr>\n\n\n            <tr>\n                <td align="center">\n                                </td>\n            </tr>\n        </table>\n\t\t<!-- google_ad_section_end -->\n        <center>\n        \t\t<div class="wd_code_links">\n\t\t<u>Forum Code to link to this word:</u><br/>\n        [big][url=http://www.cantonese.sheik.co.uk/dictionary/words/9621/]偏偏[/url][/big]        <br/>\n        <u>HTML Code to link to this word:</u>\n        <br/>\n        &lt;a href=&quot;http://www.cantonese.sheik.co.uk/dictionary/words/9621/&quot; class=&quot;chinesemed&quot; target=&quot;_blank&quot;&gt;&amp;#20559;&amp;#20559;&lt;/a&gt;        <br/>\n        Decimal representation of this word: &amp;#20559;&amp;#20559;        </div>\n        </center>\n            <table align="center" border="0">\n<tr><td align="center"><FORM>\n<INPUT TYPE="Button" VALUE="Back"\nonClick="history.go(-1)">\n</FORM>\n</td></tr></table>\n<div id="searchbox">\n<form class="searchbox" action="http://www.cantonese.sheik.co.uk/scripts/wordsearch.php?level=0" method="post" name="searchform">\nSearch CantoDict\n <small>(<a href="http://www.cantodict.org/safesearch.htm" target="_blank">safe search</a> is on)</small>\n<br/>\n<input size="16" class="cantodict_search_input" type="text" name="TEXT" value="">\n<select class="cantodict_search_input" name="SEARCHTYPE" onchange="disableButton();">\n<option  value="4">English meaning</option>\n<option  value="2">Chinese Character</option>\n<option  value="1">Chinese Word</option>\n<option  value="6">Chinese Word (initial)</option>\n<option  value="7">Chinese Word (final)</option>\n<option  value="3">Jyutping (Cantonese)</option>\n<option  value="5">Pinyin (Mandarin)</option>\n<option  value="8">Radical</option>\n<option  value="11">Unicode value</option>\n<optgroup label="Search Example Sentences">\n\t<option  value="12">Meaning of sentence</option>\n\n</optgroup>\n</select>\n<select name="radicaldropdown" style="display:inline; font-family: 'arial unicode MS',MingLiu" class="radicaldropdown">\n<option selected value="0"></option>\n<optgroup label="1 stroke">\n<option value="1">1: &#19968; (one)</option>\n<option value="2">2: &#20008; (line)</option>\n<option value="3">3: &#20022; (dot)</option>\n<option value="4">4: &#20031; (slash)</option>\n<option value="5">5: &#20057; or &#20058; (second)</option>\n<option value="6">6: &#20101; (hook)</option>\n</optgroup>\n<optgroup label="2 strokes">\n<option value="7">7: &#20108; (two)</option>\n<option value="8">8: &#20128; (lid)</option>\n<option value="9">9: &#20155; or &#20154; (man)</option>\n<option value="10">10: &#20799; (legs)</option>\n<option value="11">11: &#20837; (enter)</option>\n<option value="12">12: &#20843; (eight)</option>\n<option value="13">13: &#20866; (down box)</option>\n<option value="14">14: &#20886; (cover)</option>\n<option value="15">15: &#20907; (ice)</option>\n<option value="16">16: &#20960; (table)</option>\n<option value="17">17: &#20981; (open box)</option>\n<option value="18">18: &#20992; or &#20994; (knife)</option>\n<option value="19">19: &#21147; (power)</option>\n<option value="20">20: &#21241; (wrap)</option>\n<option value="21">21: &#21269; (spoon)</option>\n<option value="22">22: &#21274; (right open box)</option>\n<option value="23">23: &#21304; (hiding enclosure)</option>\n<option value="24">24: &#21313; (ten)</option>\n<option value="25">25: &#21340; (divination)</option>\n<option value="26">26: &#21353; (seal)</option>\n<option value="27">27: &#21378; (cliff)</option>\n<option value="28">28: &#21430; (private)</option>\n<option value="29">29: &#21448; (again)</option>\n</optgroup>\n<optgroup label="3 strokes">\n<option value="30">30: &#21475; (mouth)</option>\n<option value="31">31: &#22231; (enclosure)</option>\n<option value="32">32: &#22303; (earth)</option>\n<option value="33">33: &#22763; (scholar)</option>\n<option value="34">34: &#22786; (go)</option>\n<option value="35">35: &#22794; (go slowly)</option>\n<option value="36">36: &#22805; (evening)</option>\n<option value="37">37: &#22823; (big)</option>\n<option value="38">38: &#22899; (woman)</option>\n<option value="39">39: &#23376; (child)</option>\n<option value="40">40: &#23424; (roof)</option>\n<option value="41">41: &#23544; (inch)</option>\n<option value="42">42: &#23567; (small)</option>\n<option value="43">43: &#23586; (lame)</option>\n<option value="44">44: &#23608; (corpse)</option>\n<option value="45">45: &#23662; (sprout)</option>\n<option value="46">46: &#23665; (mountain)</option>\n<option value="47">47: &#24029; or &#24027; (river)</option>\n<option value="48">48: &#24037; (work)</option>\n<option value="49">49: &#24049; (oneself)</option>\n<option value="50">50: &#24062; (turban)</option>\n<option value="51">51: &#24178; (dry)</option>\n<option value="52">52: &#24186; (tiny)</option>\n<option value="53">53: &#24191; (house on cliff)</option>\n<option value="54">54: &#24308; (long stride)</option>\n<option value="55">55: &#24318; (two hands)</option>\n<option value="56">56: &#24331; (shoot)</option>\n<option value="57">57: &#24339; (bow)</option>\n<option value="58">58: &#24400; or &#24401; (snout)</option>\n<option value="59">59: &#24417; (bristle)</option>\n<option value="60">60: &#24435; (step)</option>\n</optgroup>\n<optgroup label="4 strokes">\n<option value="61">61: &#24515; or &#24516; (heart)</option>\n<option value="62">62: &#25096; (halberd)</option>\n<option value="63">63: &#25142; (door)</option>\n<option value="64">64: &#25164; or &#25903; (hand)</option>\n<option value="65">65: &#25903; (branch)</option>\n<option value="66">66: &#25908; or &#25909; (rap)</option>\n<option value="67">67: &#25991; (script)</option>\n<option value="68">68: &#26007; (dipper)</option>\n<option value="69">69: &#26020; (axe)</option>\n<option value="70">70: &#26041; (square)</option>\n<option value="71">71: &#26080; or &#26081; (not)</option>\n<option value="72">72: &#26085; (sun)</option>\n<option value="73">73: &#26352; (say)</option>\n<option value="74">74: &#26376; (moon)</option>\n<option value="75">75: &#26408; (tree)</option>\n<option value="76">76: &#27424; (yawn)</option>\n<option value="77">77: &#27490; (stop)</option>\n<option value="78">78: &#27513; or &#27514; (death)</option>\n<option value="79">79: &#27571; (weapon)</option>\n<option value="80">80: &#27595; or &#27597;(do not)</option>\n<option value="81">81: &#27604; (compare)</option>\n<option value="82">82: &#27611; (fur)</option>\n<option value="83">83: &#27663; (clan)</option>\n<option value="84">84: &#27668; (steam)</option>\n<option value="85">85: &#27700;,&#27701; or &#27706; (water)</option>\n<option value="86">86: &#28779; or &#28780; (fire)</option>\n<option value="87">87: &#29226; or &#29227; (claw)</option>\n<option value="88">88: &#29238; (father)</option>\n<option value="89">89: &#29243; (double crosses)</option>\n<option value="90">90: &#29247;/&#20012; (bed)</option>\n<option value="91">91: &#29255; (slice)</option>\n<option value="92">92: &#29273; (fang)</option>\n<option value="93">93: &#29275; (cow)</option>\n<option value="94">94: &#29356; or &#29357;(dog)</option>\n</optgroup>\n<optgroup label="5 strokes">\n<option value="95">95: &#29572; (profound)</option>\n<option value="96">96: &#29577; or &#29579; (jade)</option>\n<option value="97">97: &#29916; (melon)</option>\n<option value="98">98: &#29926; (earthenware)</option>\n<option value="99">99: &#29976; (sweet)</option>\n<option value="100">100: &#29983; (life)</option>\n<option value="101">101: &#29992; (use)</option>\n<option value="102">102: &#30000; (field)</option>\n<option value="103">103: &#30091; (bolt of cloth)</option>\n<option value="104">104: &#30098; (sickness)</option>\n<option value="105">105: &#30326; (dotted tent)</option>\n<option value="106">106: &#30333; (white)</option>\n<option value="107">107: &#30382; (skin)</option>\n<option value="108">108: &#30399; (dish)</option>\n<option value="109">109: &#30446; (eye)</option>\n<option value="110">110: &#30683; (halberd)</option>\n<option value="111">111: &#30690; (arrow)</option>\n<option value="112">112: &#30707; (stone)</option>\n<option value="113">113: &#31034; or &#31035; (spirit)</option>\n<option value="114">114: &#31160; (track)</option>\n<option value="115">115: &#31166; (grain)</option>\n<option value="116">116: &#31348; (cave)</option>\n<option value="117">117: &#31435; (stand)</option>\n</optgroup>\n<optgroup label="6 strokes">\n<option value="118">118: &#31481; (bamboo)</option>\n<option value="119">119: &#31859; (rice)</option>\n<option value="120">120: &#31992;/&#32415; or &#31993; (silk)</option>\n<option value="121">121: &#32566; (jar)</option>\n<option value="122">122: &#32593; or &#32594; (net)</option>\n<option value="123">123: &#32650; (sheep)</option>\n<option value="124">124: &#32701; (feather)</option>\n<option value="125">125: &#32769; or &#32770; (old)</option>\n<option value="126">126: &#32780; (and)</option>\n<option value="127">127: &#32786; (plow)</option>\n<option value="128">128: &#32819; (ear)</option>\n<option value="129">129: &#32895; (brush)</option>\n<option value="130">130: &#32905; (meat)</option>\n<option value="131">131: &#33251; (minister)</option>\n<option value="132">132: &#33258; (self)</option>\n<option value="133">133: &#33267; (arrive)</option>\n<option value="134">134: &#33276; (mortar)</option>\n<option value="135">135: &#33292; (tongue)</option>\n<option value="136">136: &#33307; (oppose)</option>\n<option value="137">137: &#33311; (boat)</option>\n<option value="138">138: &#33390; (stopping)</option>\n<option value="139">139: &#33394; (color)</option>\n<option value="140">140: &#33400; or &#33401; (grass)</option>\n<option value="141">141: &#34381; (tiger)</option>\n<option value="142">142: &#34411; (insect)</option>\n<option value="143">143: &#34880; (blood)</option>\n<option value="144">144: &#34892; (walk)</option>\n<option value="145">145: &#34915; or &#34916; (clothes)</option>\n<option value="146">146: &#35199; or &#35200; or &#35198; (west)</option>\n</optgroup>\n<optgroup label="7 strokes">\n<option value="147">147: &#35211;/&#35265; (see)</option>\n<option value="148">148: &#35282; (horn)</option>\n<option value="149">149: &#35328 or &#35329;/&#35744; (speech)</option>\n<option value="150">150: &#35895; (valley)</option>\n<option value="151">151: &#35910; (bean)</option>\n<option value="152">152: &#35925; (pig)</option>\n<option value="153">153: &#35960; (badger)</option>\n<option value="154">154: &#35997;/&#36125; (shell)</option>\n<option value="155">155: &#36196; (red)</option>\n<option value="156">156: &#36208; (run)</option>\n<option value="157">157: &#36275; (foot)</option>\n<option value="158">158: &#36523; (body)</option>\n<option value="159">159: &#36554;/&#36710; (car)</option>\n<option value="160">160: &#36763; (bitter)</option>\n<option value="161">161: &#36784; (morning)</option>\n<option value="162">162: &#36789; or &#36790; (walk)</option>\n<option value="163">163: &#37009; (city)</option>\n<option value="164">164: &#37193; (wine)</option>\n<option value="165">165: &#37318; (distinguish)</option>\n<option value="166">166: &#37324; (village)</option>\n</optgroup>\n<optgroup label="8 strokes">\n<option value="167">167: &#37329; or &#37330;/&#38021; (metal)</option>\n<option value="168">168: &#38263;/&#38271; or &#38264; (long)</option>\n<option value="169">169: &#38272;/&#38376; (gate)</option>\n<option value="170">170: &#38428; or &#38429; (mound)</option>\n<option value="171">171: &#38582; (slave)</option>\n<option value="172">172: &#38585; (small bird)</option>\n<option value="173">173: &#38632; (rain)</option>\n<option value="174">174: &#38737; or &#38738; (blue)</option>\n<option value="175">175: &#38750; (wrong)</option>\n</optgroup>\n<optgroup label="9 strokes">\n<option value="176">176: &#38754; (face)</option>\n<option value="177">177: &#38761; (leather)</option>\n<option value="178">178: &#38859;/&#38886; (tanned leather)</option>\n<option value="179">179: &#38893; (leek)</option>\n<option value="180">180: &#38899; (sound)</option>\n<option value="181">181: &#38913;/&#39029; (face)</option>\n<option value="182">182: &#39080;/&#39118; (wind)</option>\n<option value="183">183: &#39131;/&#39134; (fly)</option>\n<option value="184">184: &#39135; or &#39136;/&#39267; (eat)</option>\n<option value="185">185: &#39318; (head)</option>\n<option value="186">186: &#39321; (fragrant)</option>\n</optgroup>\n<optgroup label="10 strokes">\n<option value="187">187: &#39340;/&#39532; (horse)</option>\n<option value="188">188: &#39592; (bone)</option>\n<option value="189">189: &#39640; (tall)</option>\n<option value="190">190: &#39647; (hair)</option>\n<option value="191">191: &#39717; (fight)</option>\n<option value="192">192: &#39727; (sacrificial wine)</option>\n<option value="193">193: &#39730; (cauldron)</option>\n<option value="194">194: &#39740; (ghost)</option>\n</optgroup>\n<optgroup label="11 strokes">\n<option value="195">195: &#39770;/&#40060; (fish)</option>\n<option value="196">196: &#40165;/&#40479; (bird)</option>\n<option value="197">197: &#40565; (alkaline)</option>\n<option value="198">198: &#40575; (deer)</option>\n<option value="199">199: &#40613;/&#40614; (wheat)</option>\n<option value="200">200: &#40635; (hemp)</option>\n</optgroup>\n<optgroup label="12 strokes">\n<option value="201">201: &#40643; (yellow)</option>\n<option value="202">202: &#40653; (millet)</option>\n<option value="203">203: &#40657; (black)</option>\n<option value="204">204: &#40697; (needlework)</option>\n</optgroup>\n<optgroup label="13 strokes">\n<option value="205">205: &#40701;/&#40702; (amphibian)</option>\n<option value="206">206: &#40718; (tripod)</option>\n<option value="207">207: &#40723; (drum)</option>\n<option value="208">208: &#40736; (rat)</option>\n</optgroup>\n<optgroup label="14 strokes">\n<option value="209">209: &#40763; (nose)</option>\n<option value="210">210: &#40778;/&#40784; or &#25993; (uniformly)</option>\n</optgroup>\n<optgroup label="15 strokes">\n<option value="211">211: &#40786;/&#40831; or &#27503; (tooth)</option>\n</optgroup>\n<optgroup label="16 strokes">\n<option value="212">212: &#40845;/&#40857; or &#31452; (dragon)</option>\n<option value="213">213: &#40860;/&#40863;/&#20096; (tortoise)</option>\n</optgroup>\n<optgroup label="17 strokes">\n<option value="214">214: &#40864; (flute)</option>\n</optgroup>\n</select>\n\n\t\n<input type="submit" value="search" name="searchsubmit" title="This is the normal search, and should be used by default.">\n<input type="submit" value="full search" name="searchsubmitfull" title="This option will return more results, some of which may not be as relevant to your query.">\n<br/>\n<div id="search_info_label" style="display: block">\nPlease note, CantoDict currently supports searching for Simplified Chinese, but results will be returned in Traditional Chinese.\n</div>\n<label for="HIDEWRITTENANDSPOKEN">Hide Written and Spoken</label> <input  type="checkbox" name="HIDEWRITTENANDSPOKEN" id="HIDEWRITTENANDSPOKEN">\n<label for="HIDEWRITTEN">Hide Written <a title='Mandarin / Standard written Chinese only.'><span class='mandarinbox'>&#22283;</span></a></label> <input  type="checkbox" name="HIDEWRITTEN" id="HIDEWRITTEN">\n<label for="HIDECANTONESE">Hide Spoken<a title='Cantonese only, (usually spoken but can be written)'><span class='cantonesebox'>&#31925;</span></a></label> <input  type="checkbox" name="HIDECANTONESE" id="HIDECANTONESE">\n</form>\n</div>\n\t<script language="javascript">\n\t\tfunction disableButton(){\n\t\t\tvar searchType;\n\t\t\tsearchType = document.searchform.SEARCHTYPE.options[document.searchform.SEARCHTYPE.selectedIndex].value;\n\t\t\tif (searchType != 4){\n\t\t\t\tdocument.searchform.searchsubmitfull.disabled = true;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tdocument.searchform.searchsubmitfull.disabled = false;\n\t\t\t}\n\n\t\t\tif (searchType != 8 ){\n\t\t\t\tdocument.searchform.radicaldropdown.style.display="none";\n\t\t\t\tdocument.searchform.TEXT.disabled = false;\n\t\t\t\tdocument.searchform.TEXT.style.display = "inline";\n\t\t\t}\n\t\t\telse{\n\t\t\t\tdocument.searchform.radicaldropdown.style.display="inline";\n\t\t\t\tdocument.searchform.TEXT.disabled=true;\n\t\t\t\tdocument.searchform.TEXT.style.display = "none";\n\t\t\t}\nif ((searchType == 2) || (searchType == 6) || (searchType == 7)){\ndocument.searchform.TEXT.size=13;\n}\nelse if (searchType == 1){\ndocument.searchform.TEXT.size=13;\n}\nelse{\ndocument.searchform.TEXT.size=16;\n}\nif ((searchType == 2) || (searchType == 1) || (searchType == 7) || (searchType == 6)){\ndocument.searchform.TEXT.style.fontFamily="MingLiu";\ndocument.searchform.TEXT.style.fontSize="12pt";\n}\nelse{\ndocument.searchform.TEXT.style.fontFamily="";\ndocument.searchform.TEXT.style.fontSize="";\n}\nif ((searchType == 3) || (searchType == 5)){\ndocument.searchform.TEXT.style.fontStyle="italic";\n}\nelse{\ndocument.searchform.TEXT.style.fontStyle="normal";\n}\nif (searchType == 5){\ndocument.getElementById("search_info_label").innerHTML = 'CantoDict uses separate pinyin syllables with spaces and (optional) tone numbers:  eg: <i>ni hao</i> or <i>ni3 hao3.</i> <a href="http://www.cantonese.sheik.co.uk/phorum/read.php?14,66044,66044" target="_blank">More information...</a>';\n}\nelse if (searchType == 3){\ndocument.getElementById("search_info_label").innerHTML = 'For help, please see our <a href="http://www.cantonese.sheik.co.uk/phorum/read.php?14,66046" target="_blank">Jyutping guide.</a>';\n}\nelse if (searchType == 1){\ndocument.getElementById("search_info_label").innerHTML = 'Wildcard searching is supported:  eg: <font color="blue">*&#37941;*&#37341;*</font> &nbsp; <a href="http://www.cantonese.sheik.co.uk/phorum/read.php?14,56845" target="_blank">More information...</a>';\n}\nelse if (searchType == 11){\ndocument.getElementById("search_info_label").innerHTML = 'i.e. U+xxxx';\n}\nelse{\ndocument.getElementById("search_info_label").innerHTML = "Please note, CantoDict currently supports searching for Simplified Chinese, but results will be returned in Traditional Chinese.";\n}\n}\ndisableButton()\n</script>\n</center>\n</div>\n\n<div class="char_detail_info">\n<a name="info">This page shows, from top to bottom:</a>\n<ul>\n<li>a large version of the word in a <a href="http://www.cantonese.sheik.co.uk/fonts.htm">traditional script font which you may need to install</a></li>\n<a name="jyutpinginfo"></a>\n<li>\n\t<img align="absmiddle" src="http://www.cantonese.sheik.co.uk/images/cantodict/label_jyutping.png" alt="jyutping" title="jyutping" hspace="10" vspace="2" border="0"> : the Cantonese pronunciation of the word in <a href="http://www.cantonese.sheik.co.uk/essays/jyutping.htm">jyutping.</a>\n\tAlso, CantoDict uses a unique "asterisk (*)" convention, to show readings such as <i>jyu<sup>4*2</sup></i>. For more information please see <a href="http://www.cantonese.sheik.co.uk/essays/tones.htm#cantodict_tones">CantoDict Tone Conventions.</a>\n\n</li>\n<a name="pinyininfo"></a><li><img align="absmiddle" src="http://www.cantonese.sheik.co.uk/images/cantodict/label_pinyin.png" alt="pinyin" title="pinyin" hspace="10" vspace="2" border="0"> : the Mandarin pronunciation of the word in pinyin (only if present).</li>\n<li>the meaning of the word, typed in by our volunteer editors</li>\n<li>guidelines on whether the word can only be used in Spoken Cantonese etc (if nothing is present the word may be used in both Cantonese and Mandarin)</li>\n<li>our arbitrarily assigned difficulty level</li>\n<li>a smaller version of the character in a computerised, printed font</li>\n<li>a list of each of the characters for the word, showing jyutping and meaning (if our dictionary contains that character)</li>\n\n\n<li>a list of all Cantonese homophones / homophone variants. These are words that sound identical but may or may not mean the same thing.</li>\n\n<br/>We would really appreciate new volunteers to add some more compound words to the\ndatabase so please see\n<a href="http://www.cantonese.sheik.co.uk/phorum/read.php?14,6727">this thread</a>\nif you would like to spend 10 mins or so helping.\n</li>\n</ul>\n</div>\n\n\n<center>\n<span class="scripttime">Script executed in 0.019145 secs</span>\n<br/>\n<span class="scripttime">Rows returned from database=4</span>\n\n\n\t\n\t<div class="dictionarycredits" >\n\t\t<a href="http://www.cantonese.sheik.co.uk/donate.htm"><img src="http://www.cantonese.sheik.co.uk/images/donate.png" alt="Donate to CantoDict" border="0" vspace="4"></a>\n\t<br/>\n\t\t<a href="http://www.cantodict.org" target="_blank">CantoDict</a> <a href="/phorum/read.php?14,85264,gotonewpost" target="_blank">v1.4.2</a> is a collaborative Chinese Dictionary project started in November 2003. Entries are added and mistakes corrected by a team of kind <a href="http://www.cantonese.sheik.co.uk/scripts/editors.htm">volunteers</a> from around the world. <br/>\n\t<a href="http://www.cantonese.sheik.co.uk/copyright.htm">Copyright</a> Adam Sheik 2003-2024.\n\t</div>\n\t</center>\n\n<script type="text/javascript">\n\t$(document).ready(function() {\n\t\t$(".fancybox").fancybox({\n\t\t\t\topenEffect\t: 'elastic',\n\t\t\t\tcloseEffect\t: 'elastic',\n\t\t\t\thelpers : {\n\t\t\t\t\t\ttitle : {\n\t\t\t\t\t\t\ttype : 'inside'\n\t\t\t\t\t\t}\n    \t}\n\t\t});\n\t\t\n\t\t\n\t});\n</script>\n\n</body>\n</html>\n"
"###;

    #[test]
    fn test_cantodict_search() {
        let word_url = get_word_url("心中", EXAMPLE_PAGE);

        assert_eq!(
            word_url,
            Some("http://www.cantonese.sheik.co.uk/dictionary/words/6600/".to_string())
        );
    }

    #[test]
    fn test_cantodict_definitions() {
        let word_url = get_definitions(EXAMPLE_DETAIL_PAGE);

        assert_eq!(
            word_url,
            Some("[1] just [2] but [3] only [4] wilfully; insistently; persistently [5] contrary to expectations [6] unfortunately [7] perversely".to_string())
        );
    }
}
